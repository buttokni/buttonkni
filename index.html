<!-- Add this HTML right before the closing body tag -->
<div class="leaderboard-container">
    <button class="leaderboard-button" onclick="toggleLeaderboard()">üèÜ</button>
    <div class="leaderboard-modal" id="leaderboardModal">
        <div class="leaderboard-content">
            <div class="leaderboard-header">
                <h2>Leaderboard</h2>
                <button class="close-button" onclick="toggleLeaderboard()">√ó</button>
            </div>
            <div class="leaderboard-tabs">
                <button class="tab-button active" onclick="switchTab('daily')">Today's Records</button>
                <button class="tab-button" onclick="switchTab('allTime')">All-Time Best</button>
            </div>
            <div id="dailyLeaderboard" class="leaderboard-body">
                <!-- Daily records will be inserted here -->
            </div>
            <div id="allTimeLeaderboard" class="leaderboard-body" style="display: none;">
                <!-- All-time records will be inserted here -->
            </div>
        </div>
    </div>
</div>

<style>
.leaderboard-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
}

.leaderboard-button {
    background: transparent;
    border: 2px solid #ff0000;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    animation: rainbow 5s linear infinite;
}

.leaderboard-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    z-index: 1001;
}

.leaderboard-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #0a1929;
    border: 3px solid;
    animation: rainbow 5s linear infinite;
    border-radius: 15px;
    padding: 20px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow-y: auto;
}

.leaderboard-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 10px;
}

.tab-button {
    background: none;
    border: none;
    color: white;
    padding: 8px 16px;
    cursor: pointer;
    opacity: 0.6;
    transition: opacity 0.3s;
    border-radius: 20px;
}

.tab-button.active {
    opacity: 1;
    background: rgba(255, 255, 255, 0.1);
}

.leaderboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.leaderboard-header h2 {
    margin: 0;
    color: white;
}

.close-button {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
}

.leaderboard-body {
    color: white;
}

.leaderboard-entry {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 15px;
    padding: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    align-items: center;
}

.rank {
    font-weight: bold;
    min-width: 30px;
}

.medal {
    font-size: 20px;
    margin-right: 5px;
}

.completion-time {
    text-align: right;
    font-family: monospace;
}

.username {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.date-completed {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
    grid-column: 2 / -1;
    text-align: right;
}
</style>

<script>
// Initialize leaderboards from localStorage or create empty arrays
let dailyLeaderboard = JSON.parse(localStorage.getItem('dailyLeaderboard')) || [];
let allTimeLeaderboard = JSON.parse(localStorage.getItem('allTimeLeaderboard')) || [];

// Check if we need to reset daily leaderboard
const lastResetDate = localStorage.getItem('lastResetDate');
const today = new Date().toDateString();

if (lastResetDate !== today) {
    dailyLeaderboard = [];
    localStorage.setItem('dailyLeaderboard', JSON.stringify(dailyLeaderboard));
    localStorage.setItem('lastResetDate', today);
}

function toggleLeaderboard() {
    const modal = document.getElementById('leaderboardModal');
    if (modal.style.display === 'block') {
        modal.style.display = 'none';
    } else {
        updateLeaderboard('daily');
        modal.style.display = 'block';
    }
}

function switchTab(tab) {
    // Update tab buttons
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });
    event.target.classList.add('active');

    // Show selected leaderboard
    document.getElementById('dailyLeaderboard').style.display = tab === 'daily' ? 'block' : 'none';
    document.getElementById('allTimeLeaderboard').style.display = tab === 'allTime' ? 'block' : 'none';

    updateLeaderboard(tab);
}

function formatDate(date) {
    const options = { month: 'short', day: 'numeric', year: 'numeric' };
    return new Date(date).toLocaleDateString(undefined, options);
}

function updateLeaderboard(type = 'daily') {
    const leaderboardElement = document.getElementById(`${type}Leaderboard`);
    const leaderboardData = type === 'daily' ? dailyLeaderboard : allTimeLeaderboard;
    
    // Sort leaderboard by completion time
    const sortedLeaderboard = [...leaderboardData].sort((a, b) => a.completionTime - b.completionTime);
    
    leaderboardElement.innerHTML = '';

    sortedLeaderboard.forEach((entry, index) => {
        const entryElement = document.createElement('div');
        entryElement.className = 'leaderboard-entry';

        // Determine medal emoji for top 3
        let medal = '';
        if (index === 0) medal = 'ü•á';
        else if (index === 1) medal = 'ü•à';
        else if (index === 2) medal = 'ü•â';

        // Format completion time
        const minutes = Math.floor(entry.completionTime / 60000);
        const seconds = ((entry.completionTime % 60000) / 1000).toFixed(1);
        const timeString = `${minutes}m ${seconds}s`;

        entryElement.innerHTML = `
            <div class="rank">${medal || (index + 1)}</div>
            <div class="username">${entry.username}</div>
            <div class="completion-time">${timeString}</div>
            ${type === 'allTime' ? `<div class="date-completed">Set on ${formatDate(entry.date)}</div>` : ''}
        `;

        leaderboardElement.appendChild(entryElement);
    });

    if (sortedLeaderboard.length === 0) {
        leaderboardElement.innerHTML = '<p style="text-align: center">No completions yet!</p>';
    }
}

function addToLeaderboard(completionTime) {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    const currentDate = new Date().toISOString();
    
    // Add to daily leaderboard
    const existingDailyEntry = dailyLeaderboard.find(entry => entry.username === currentUser.username);
    if (existingDailyEntry) {
        if (completionTime < existingDailyEntry.completionTime) {
            existingDailyEntry.completionTime = completionTime;
            existingDailyEntry.date = currentDate;
        }
    } else {
        dailyLeaderboard.push({
            username: currentUser.username,
            completionTime: completionTime,
            date: currentDate
        });
    }
    
    // Add to all-time leaderboard
    const existingAllTimeEntry = allTimeLeaderboard.find(entry => 
        entry.username === currentUser.username && 
        entry.code === correctCode
    );
    
    if (existingAllTimeEntry) {
        if (completionTime < existingAllTimeEntry.completionTime) {
            existingAllTimeEntry.completionTime = completionTime;
            existingAllTimeEntry.date = currentDate;
        }
    } else {
        allTimeLeaderboard.push({
            username: currentUser.username,
            completionTime: completionTime,
            date: currentDate,
            code: correctCode
        });
    }
    
    // Save both leaderboards
    localStorage.setItem('dailyLeaderboard', JSON.stringify(dailyLeaderboard));
    localStorage.setItem('allTimeLeaderboard', JSON.stringify(allTimeLeaderboard));
    
    // Update display
    updateLeaderboard('daily');
}

// Close modal when clicking outside
window.addEventListener('click', function(event) {
    const modal = document.getElementById('leaderboardModal');
    if (event.target === modal) {
        modal.style.display = 'none';
    }
});
</script>
